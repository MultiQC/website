---
import PageLayout from "@layouts/PageLayout.astro";
import Button from "@components/Button.svelte";
import Card from "@components/Card.astro";
import { Icon } from "astro-icon";
---

<PageLayout
  title="Run MultiQC in your browser"
  subtitle="âœ¨ Run MultiQC in your browser on local files, with Web Assembly."
>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js" is:inline></script>
  <script src="../scripts/run.js"></script>

  <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
    <div>
      <p>
        <Button btnId="butDirectory" variant="primary" size="md" classes="mb-4 mr-2">
          <Icon name="mdi:folder-search" class="mr-3 h-6 w-6" />
          Step 1 - Choose Directory
        </Button>
      </p>
      <p>
        <Button btnId="runMultiQC" variant="primary" size="md" classes="mb-4 mr-2" disabled="true">
          <Icon name="mdi:motion-play-outline" class="mr-3 h-6 w-6" />
          Step 2 - Run MultiQC
        </Button>
      </p>
      <p>
        <Button btnId="openReport" variant="primary" size="md" classes="mb-4 mr-2" disabled="true">
          <Icon name="mdi:eye-outline" class="mr-3 h-6 w-6" />
          Step 3 - Open report
        </Button>
      </p>
    </div>
    <div>
      <div
        id="drop_files"
        class="rounded-sm border border-dashed border-gray-400 p-6 text-gray-200 opacity-60 transition-opacity"
      >
        <div id="loading_spinner" class="text-center" role="status">
          <svg
            aria-hidden="true"
            class="mr-2 inline h-4 w-4 animate-spin fill-blue-400 text-gray-200 dark:text-gray-600"
            viewBox="0 0 100 101"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C90.9186 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z"
              fill="currentColor"></path>
            <path
              d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0491C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z"
              fill="currentFill"></path>
          </svg>
          <span>Loading...</span>
        </div>
        <div id="drop_files_helptext" class="hidden text-center">
          <span>Drag and drop files here, or click "Choose directory" above.</span>
        </div>
      </div>
    </div>
  </div>
  <pre
    id="stdout"
    class="rounded-sm border border-gray-400 p-6 text-gray-400">MultiQC log: waiting</pre>
  <h2 class="typo-h4 mb-6 mt-12">Frequently Asked Questions</h2>

  <div class="mb-8">
    <Card slim="true">
      <h3 class="typo-h6">What is this?</h3>
      <p>
        This is the real MultiQC tool, running in your browser. No installation required, no data
        uploaded to the internet. Welcome to the future.
      </p>
    </Card>
  </div>

  <div class="mb-8">
    <Card slim="true">
      <h3 class="typo-h6">Who is it for?</h3>
      <p>
        This is great for anyone who gets emailed a zip file full of FastQC reports, who wants to
        quickly summarise them. It's good for running demos and training, and good for anyone who
        feels a cold sweat when they hear the words <em>"now open the terminal"</em>.
      </p>
    </Card>
  </div>

  <div class="mb-8">
    <Card slim="true">
      <h3 class="typo-h6">What files am I meant to give it?</h3>
      <p>
        Feed it analysis outputs from bioinformatics tools <a href="/modules/" class="typo-link"
          >supported by MultiQC</a
        >. Don't worry about being selective, MultiQC will ignore any files it doesn't recognise
        (eg. those big BAM files). No data is transferred over the internet, only mounted from your
        local filesystem. So number and filesize of files shouldn't matter.
      </p>
    </Card>
  </div>

  <div class="mb-8">
    <Card slim="true">
      <h3 class="typo-h6">Do you have any I can try with?</h3>
      <p>
        Sure! All of the <a href="/example-reports/" class="typo-link">example reports</a> have associated
        raw data for you to play with. In fact, there's some <a
          href="/examples/rna-seq/data.zip"
          class="typo-link">right here</a
        >! Just remember to unzip the file before running with MultiQC.
      </p>
    </Card>
  </div>

  <div class="mb-8">
    <Card slim="true">
      <h3 class="typo-h6">How does it work?</h3>
      <p class="mb-3">
        This web page uses a relatively new technology called <a
          href="https://webassembly.org/"
          class="typo-link">WebAssembly</a
        > (Wasm). This builds a virtual machine within your browser, which can run compiled code. If
        you're familiar with Docker, it's a similar concept.
      </p>
      <p>
        Here, we're using <a href="https://pyodide.org/" class="typo-link">Pyodide</a>, a Python
        distribution built for Wasm. It lets us install packages from the <a
          href="https://pypi.org/"
          class="typo-link">Python Package Index</a
        > (PyPI) and has a robust Javascript interface for interacting with the browser. This lets us
        install and run MultiQC entirely within the browser Wasm virtual machine without needing any
        other installation requirements, and without any data transfer to the web.
      </p>
    </Card>
  </div>

  <div class="mb-8">
    <Card slim="true">
      <h3 class="typo-h6">So is my data being uploaded?</h3>
      <p>
        No, this is entirely local to your browser. Try turning wifi off after the page has loaded -
        it should still all work!
      </p>
    </Card>
  </div>

  <div class="mb-8">
    <Card slim="true">
      <h3 class="typo-h6">Will this replace the command-line version of MultiQC?</h3>
      <p>
        Not at all. Most people run MultiQC in a non-interactive setting, such as a step in an
        analysis pipeline. That will remain the primary interface to MultiQC. This is just a bit of
        fun which is hopefully helpful for a group of people not comfortable with terminals and CLIs
      </p>
    </Card>
  </div>
  <div class="mb-8">
    <Card slim="true">
      <h3 class="typo-h6">
        I gave it a <code>.fastq</code> file, but it said no files found
      </h3>
      <p>
        That's because MultiQC uses outputs from other analysis tools, it doesn't do the analysis
        itself. Check out the <a href="/docs/" class="typo-link">documentation</a> for more details.
      </p>
    </Card>
  </div>
</PageLayout>
