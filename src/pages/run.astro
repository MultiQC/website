---
import PageLayout from "@layouts/PageLayout.astro";
import Button from "@components/Button.svelte";
import CardThin from "@components/CardThin.astro";
import Spinner from "@components/Spinner.astro";
import { Icon } from "astro-icon";
---

<PageLayout
  title="Run MultiQC in your browser"
  subtitle="âœ¨ Run MultiQC in your browser on local files, with Web Assembly."
>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js" is:inline></script>
  <script src="/run_deps/run.js" type="text/javascript" is:inline></script>

  <div class="mb-10 grid grid-cols-1 gap-4 sm:grid-cols-2">
    <div>
      <p>
        <Button btnId="btn_choose_dir" variant="primary" size="md" classes="mb-4 mr-2">
          <Icon name="mdi:folder-search" class="mr-3 h-6 w-6" />
          Step 1 - Choose Directory
        </Button>
      </p>
      <p>
        <Button
          btnId="btn_run_multiQC"
          variant="primary"
          size="md"
          classes="mb-4 mr-2"
          disabled={true}
        >
          <Icon name="mdi:motion-play-outline" class="mr-3 h-6 w-6" />
          Step 2 - Run MultiQC
        </Button>
      </p>
      <p>
        <Button btnId="btn_open_report" variant="primary" size="md" classes="mr-2" disabled={true}>
          <Icon name="mdi:eye-outline" class="mr-3 h-6 w-6" />
          <span id="btn_open_report_text">Step 3 - Open report</span>
        </Button>
      </p>
    </div>
    <div>
      <div
        id="drop_files"
        class="mr-1 flex h-full items-center rounded-sm border border-dashed border-gray-400 p-6 text-gray-200 opacity-60 transition-opacity"
      >
        <div id="unsupported_browser" class="hidden text-red-400">
          Sorry, your browser doesn't support the <code>showDirectoryPicker</code> method. Please try
          a different browser (<a
            href="https://developer.mozilla.org/en-US/docs/Web/API/Window/showDirectoryPicker#browser_compatibility"
            target="_blank"
            class="typo-link">see supported browsers</a
          >).
        </div>
        <div id="loading_spinner" class="w-full text-center"><Spinner /></div>
        <div id="drop_files_helptext" class="hidden w-full text-center">
          <span>Drag and drop a directory here, or click "Choose directory".</span>
        </div>
        <pre id="drop_files_listfiles" class="hidden"></pre>
      </div>
    </div>
  </div>
  <!-- MultiQC "terminal" -->
  <div class="w-full">
    <div
      class="coding inverse-toggle rounded-sm border border-gray-700 border-opacity-50 bg-black bg-opacity-20 px-5 pb-6 pt-4 font-mono text-sm text-gray-100 subpixel-antialiased shadow-lg"
    >
      <div class="top mb-2 flex opacity-70">
        <div class="h-3 w-3 rounded-full bg-rose-600"></div>
        <div class="ml-2 h-3 w-3 rounded-full bg-orange-300"></div>
        <div class="ml-2 h-3 w-3 rounded-full bg-green-500"></div>
      </div>
      <div class="mt-4">
        <span class="mr-2 text-green-400">$</span>
        <span id="terminal_run_multiqc" style="display:none;"
          ><a href="#" class="typo-link"></a></span
        >
        <span id="terminal_command"></span>
        <pre id="stdout" style="display:none;"></pre>
        <span id="blinking_cursor">&nbsp;</span>
        <div id="terminal_open_report" class="mt-4" style="display:none;">
          <a href="#" class="typo-link">Open report</a>
        </div>
      </div>
    </div>
  </div>

  <h2 class="typo-h4 mb-6 mt-12">Frequently Asked Questions</h2>

  <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
    <div class="mb-8">
      <CardThin title="What is this?">
        <p>
          This is the real MultiQC tool, running in your browser. No installation required, no data
          uploaded to the internet. Welcome to the future.
        </p>
      </CardThin>
    </div>

    <div class="mb-8">
      <CardThin title="Who is it for?">
        <p>
          This is great for anyone who gets emailed a zip file full of FastQC reports, who wants to
          quickly summarise them. It's good for running demos and training, and good for anyone who
          feels a cold sweat when they hear the words <em>"now open the terminal"</em>.
        </p>
      </CardThin>
    </div>

    <div class="mb-8">
      <CardThin title="What files am I meant to give it?">
        <p class="mb-3">
          Feed it analysis outputs from bioinformatics tools <a href="/modules/"
            >supported by MultiQC</a
          >. Don't worry about being selective, MultiQC will ignore any files it doesn't recognise
          (eg. those big BAM files). No data is transferred over the internet, only mounted from
          your local filesystem. So number and filesize of files shouldn't matter.
        </p>
        <p>
          Note that currently it can only accept a single directory, so put everything you want to
          run inside that.
        </p>
      </CardThin>
    </div>

    <div class="mb-8">
      <CardThin title="Do you have any I can try with?">
        <p>
          Sure! All of the <a href="/example-reports/">example reports</a> have associated raw data for
          you to play with. In fact, there's some <a href="/examples/rna-seq/data.zip">right here</a
          >! Just remember to unzip the file before running with MultiQC.
        </p>
      </CardThin>
    </div>

    <div class="mb-8">
      <CardThin title="How does it work?">
        <p class="mb-3">
          This web page uses a relatively new technology called <a href="https://webassembly.org/"
            >WebAssembly</a
          > (Wasm). This builds a virtual machine within your browser, which can run compiled code. If
          you're familiar with Docker, it's a similar concept.
        </p>
        <p>
          Here, we're using <a href="https://pyodide.org/">Pyodide</a>, a Python distribution built
          for Wasm. It lets us install packages from the <a href="https://pypi.org/"
            >Python Package Index</a
          > (PyPI) and has a robust Javascript interface for interacting with the browser. This lets
          us install and run MultiQC entirely within the browser Wasm virtual machine without needing
          any other installation requirements, and without any data transfer to the web.
        </p>
      </CardThin>
    </div>

    <div class="mb-8">
      <CardThin title="Will this replace the command-line version of MultiQC?">
        <p class="mb-3">
          Not at all. Most people run MultiQC in a non-interactive setting, such as a step in an
          analysis pipeline. That will remain the primary interface to MultiQC.
        </p><p>
          This is just a bit of fun which is hopefully helpful for a group of people not comfortable
          with terminals and CLIs
        </p>
      </CardThin>
    </div>

    <div class="mb-8">
      <CardThin title="So is my data being uploaded?">
        <p>
          No, this is entirely local to your browser. Try turning wifi off after the page has loaded
          - it should still all work!
        </p>
      </CardThin>
    </div>
    <div class="mb-8">
      <CardThin title="I gave it a <code>.fastq</code> file, but it said no files found">
        <p>
          That's because MultiQC uses outputs from other analysis tools, it doesn't do the analysis
          itself. Check out the <a href="/docs/">documentation</a> for more details.
        </p>
      </CardThin>
    </div>
  </div>
</PageLayout>
